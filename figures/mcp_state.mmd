stateDiagram-v2
    [*] --> Host初始状态 : 启动应用
    
    state MCP客户端 {
        Host初始状态 --> 未配置 : 检查配置
        未配置 --> 配置中 : 用户添加配置
        未配置 --> 基础对话模式 : 无MCP服务器对话
        配置中 --> 连接初始化 : 创建MCP客户端
    }
    
    state MCP服务器交互 {
        连接初始化 --> 服务器连接中 : 根据传输类型连接
        服务器连接中 --> 连接失败 : 服务器未响应
        服务器连接中 --> 连接成功 : 握手成功
        连接成功 --> 工具发现 : 获取可用工具
        工具发现 --> 工具就绪 : 注册工具到系统
    }
    
    state 对话流程 {
        工具就绪 --> 增强对话模式 : 启用工具支持
        增强对话模式 --> 工具选择 : AI决定使用工具
        工具选择 --> 工具调用 : 发送调用请求
        工具调用 --> 工具执行 : 服务器处理请求
        工具执行 --> 结果返回 : 获取执行结果
        结果返回 --> 增强对话模式 : 继续对话
        工具选择 --> 增强对话模式 : 无需调用工具
    }
    
    连接失败 --> 基础对话模式 : 降级到无工具模式
    基础对话模式 --> 增强对话模式 : MCP连接恢复
    
    增强对话模式 --> 会话结束 : 用户结束会话
    基础对话模式 --> 会话结束 : 用户结束会话
    
    工具调用 --> 调用失败 : 连接断开/超时
    调用失败 --> 基础对话模式 : 降级处理
    
    会话结束 --> 连接保持 : 保持工具连接
    连接保持 --> 连接关闭 : 会话超时/用户关闭
    连接关闭 --> [*] : 退出应用
    
    Host初始状态 : bolt.SE应用启动
    未配置 : 无MCP服务器配置
    配置中 : 配置MCP服务器
    连接初始化 : 创建MCP客户端实例
    服务器连接中 : 连接到MCP服务器
    连接失败 : 服务器连接失败
    连接成功 : 服务器连接成功
    工具发现 : 获取服务器提供的工具
    工具就绪 : 工具加载完成
    基础对话模式 : 无工具辅助对话
    增强对话模式 : 工具辅助对话
    工具选择 : AI决定使用哪个工具
    工具调用 : 请求服务器执行工具
    工具执行 : 服务器处理工具请求
    结果返回 : 工具执行结果返回
    调用失败 : 工具调用过程失败
    会话结束 : 对话会话结束
    连接保持 : 保持服务器连接状态
    连接关闭 : 关闭所有MCP连接 